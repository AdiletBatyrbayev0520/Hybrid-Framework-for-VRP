# API компонент для решения задачи коммивояжера

Данный компонент предоставляет REST API для решения задачи коммивояжера (TSP) двумя методами:
1. Алгоритм Хелда-Карпа (динамическое программирование)
2. Алгоритм Double Q-learning (обучение с подкреплением)

## Структура директории

```
Application_part/
├── server_starter.py    # Скрипт для одновременного запуска обоих API-серверов
├── test_api.py          # Скрипт для тестирования API
├── comparison_results.png  # Графическое сравнение алгоритмов
└── README.md            # Этот файл
```

## Доступные API

### 1. API для алгоритма Хелда-Карпа (DP API)

- **URL**: `http://localhost:8000/solve`
- **Метод**: POST
- **Ограничение**: До 20 городов из-за экспоненциальной сложности алгоритма
- **Особенность**: Гарантированно находит оптимальное решение

### 2. API для алгоритма Double Q-learning (RL API)

- **URL**: `http://localhost:8001/solve`
- **Метод**: POST
- **Особенность**: Может работать с большим количеством городов
- **Конфигурация**: Позволяет указать путь к весам обученной модели

## Запуск API-серверов

Для одновременного запуска обоих API-серверов используйте:

```bash
python Application_part/server_starter.py
```

Для запуска серверов по отдельности:

```bash
# Запуск DP API
python DP_part/dp_api.py

# Запуск RL API
python RL_part/rl_api.py
```

## Формат запросов

### Запрос к API

```json
{
  "distance_matrix": [
    [0, 10, 15, 20],
    [10, 0, 35, 25],
    [15, 35, 0, 30],
    [20, 25, 30, 0]
  ]
}
```

### Дополнительные параметры для RL API

```json
{
  "distance_matrix": [...],
  "weights_path": "runs/test_3"  // Опциональный путь к файлам q1_weights.txt и q2_weights.txt
}
```

## Формат ответа

```json
{
  "route": ["City_0", "City_1", "City_3", "City_2", "City_0"],
  "total_distance": 80.5,
  "execution_time_ms": 12.45
}
```

## Тестирование API

Для тестирования API используйте скрипт `test_api.py`:

```bash
python Application_part/test_api.py
```

Этот скрипт отправляет тестовые запросы к обоим API и выводит результаты.

## Особенности RL API

- **Предобученные веса**: По умолчанию используются веса из директории `RL_part/runs/test_3`
- **Параметры запроса**: Возможность указать путь к весам через параметр `weights_path`
- **Резервное решение**: Если веса не найдены, используется случайная инициализация

## Устранение неполадок

1. **Проблема**: Сервер не запускается
   **Решение**: Убедитесь, что порты 8000 и 8001 свободны

2. **Проблема**: Ошибка при загрузке весов в RL API
   **Решение**: Проверьте путь к весам в запросе или наличие файлов в директории `RL_part/runs/test_3`

3. **Проблема**: DP API выдает ошибку при большом количестве городов
   **Решение**: Используйте RL API для задач с более чем 20 городами

## Требования

- fastapi
- uvicorn
- numpy
- pandas